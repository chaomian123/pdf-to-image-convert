<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF转图片转换器</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #ff6b6b, #feca57);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .upload-area {
            padding: 40px;
            text-align: center;
        }

        .upload-box {
            border: 3px dashed #ddd;
            border-radius: 15px;
            padding: 60px 40px;
            background: #fafafa;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }

        .upload-box:hover {
            border-color: #667eea;
            background: #f0f4ff;
            transform: translateY(-2px);
        }

        .upload-box.dragover {
            border-color: #ff6b6b;
            background: #fff5f5;
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 4em;
            color: #ddd;
            margin-bottom: 20px;
            transition: color 0.3s ease;
        }

        .upload-box:hover .upload-icon {
            color: #667eea;
        }

        .upload-text {
            font-size: 1.2em;
            color: #666;
            margin-bottom: 15px;
        }

        .upload-hint {
            color: #999;
            font-size: 0.9em;
        }

        #fileInput {
            display: none;
        }

        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .progress-container {
            padding: 0 40px 20px;
            display: none;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #f0f0f0;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff6b6b, #feca57);
            width: 0%;
            transition: width 0.3s ease;
        }

        .progress-text {
            text-align: center;
            margin-top: 10px;
            color: #666;
        }

        .results {
            padding: 40px;
            display: none;
        }

        .results h2 {
            color: #333;
            margin-bottom: 20px;
            text-align: center;
        }

        .image-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .image-item {
            background: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .image-item:hover {
            transform: translateY(-5px);
        }

        .image-preview {
            width: 100%;
            height: 200px;
            object-fit: contain;
            border-radius: 8px;
            background: #f9f9f9;
            border: 1px solid #eee;
        }

        .image-info {
            margin-top: 10px;
            text-align: center;
        }

        .page-number {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .download-btn {
            background: linear-gradient(135deg, #ff6b6b, #feca57);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 15px;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .download-btn:hover {
            transform: scale(1.05);
        }

        .download-all {
            text-align: center;
            margin-top: 20px;
        }

        .error-message {
            background: #ffe6e6;
            color: #d63031;
            padding: 15px;
            border-radius: 8px;
            margin: 20px;
            border-left: 4px solid #d63031;
            display: none;
        }

        .file-info {
            background: #f8f9fa;
            padding: 20px;
            margin: 20px 40px;
            border-radius: 10px;
            display: none;
        }

        .file-info h3 {
            color: #333;
            margin-bottom: 10px;
        }

        .settings {
            padding: 20px 40px;
            border-top: 1px solid #eee;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .setting-item label {
            color: #666;
            font-weight: 500;
        }

        .setting-item select,
        .setting-item input {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: white;
        }

        .long-image {
            grid-column: 1 / -1;
            max-width: 100%;
        }

        .long-image .image-preview {
            width: 100%;
            height: auto;
            max-height: 500px;
            object-fit: contain;
        }

        .trim-info {
            background: #e3f2fd;
            color: #1565c0;
            padding: 10px;
            border-radius: 6px;
            font-size: 0.9em;
            margin-top: 10px;
            border-left: 3px solid #2196f3;
        }

        .mode-hint {
            background: #f3e5f5;
            color: #7b1fa2;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.85em;
            margin-top: 5px;
            text-align: center;
        }
            .container {
                margin: 10px;
                border-radius: 15px;
            }
            
            .header {
                padding: 30px 20px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .upload-area {
                padding: 20px;
            }
            
            .upload-box {
                padding: 40px 20px;
            }
            
            .image-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 头部 -->
        <div class="header">
            <h1>📄➡️🖼️ PDF转图片</h1>
            <p>简单、快速、安全的PDF转换工具</p>
        </div>

        <!-- 上传区域 -->
        <div class="upload-area">
            <div class="upload-box" id="uploadBox">
                <div class="upload-icon">📁</div>
                <div class="upload-text">点击或拖拽PDF文件到这里</div>
                <div class="upload-hint">支持拖拽上传，文件大小限制50MB</div>
                <input type="file" id="fileInput" accept=".pdf" />
            </div>
        </div>

        <!-- 设置选项 -->
        <div class="settings">
            <div class="setting-item">
                <label>转换模式:</label>
                <select id="modeSelect">
                    <option value="separate">分页模式 (每页单独图片)</option>
                    <option value="merge">长条模式 (合并为一张长图)</option>
                </select>
            </div>
            <div class="setting-item">
                <label>图片格式:</label>
                <select id="formatSelect">
                    <option value="png">PNG (高质量)</option>
                    <option value="jpeg">JPEG (较小文件)</option>
                </select>
            </div>
            <div class="setting-item">
                <label>图片质量:</label>
                <select id="qualitySelect">
                    <option value="1">低质量 (1x)</option>
                    <option value="1.5" selected>标准质量 (1.5x)</option>
                    <option value="2">高质量 (2x)</option>
                    <option value="3">超高质量 (3x)</option>
                </select>
            </div>
            <div class="setting-item" id="trimSetting">
                <label>去除空白:</label>
                <select id="trimSelect">
                    <option value="auto" selected>自动检测并去除</option>
                    <option value="top">仅去除顶部空白</option>
                    <option value="bottom">仅去除底部空白</option>
                    <option value="none">不去除空白</option>
                </select>
            </div>
            <div class="setting-item" id="spacingSetting">
                <label>页面间距:</label>
                <select id="spacingSelect">
                    <option value="0">无间距</option>
                    <option value="10" selected>小间距 (10px)</option>
                    <option value="20">中间距 (20px)</option>
                    <option value="30">大间距 (30px)</option>
                </select>
            </div>
        </div>

        <!-- 文件信息 -->
        <div class="file-info" id="fileInfo">
            <h3>📋 文件信息</h3>
            <p id="fileDetails"></p>
        </div>

        <!-- 进度条 -->
        <div class="progress-container" id="progressContainer">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-text" id="progressText">准备转换...</div>
        </div>

        <!-- 错误信息 -->
        <div class="error-message" id="errorMessage"></div>

        <!-- 转换结果 -->
        <div class="results" id="results">
            <h2>🎉 转换完成</h2>
            <div class="image-grid" id="imageGrid"></div>
            <div class="download-all">
                <button class="btn" id="downloadAllBtn">📦 下载所有图片 (ZIP)</button>
                <button class="btn" id="resetBtn">🔄 转换新文件</button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script>
        // 设置 PDF.js worker
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        // DOM 元素
        const uploadBox = document.getElementById('uploadBox');
        const fileInput = document.getElementById('fileInput');
        const fileInfo = document.getElementById('fileInfo');
        const fileDetails = document.getElementById('fileDetails');
        const progressContainer = document.getElementById('progressContainer');
        const progressFill = document.getElementById('progressFill');
        const progressText = document.getElementById('progressText');
        const errorMessage = document.getElementById('errorMessage');
        const results = document.getElementById('results');
        const imageGrid = document.getElementById('imageGrid');
        const formatSelect = document.getElementById('formatSelect');
        const qualitySelect = document.getElementById('qualitySelect');
        const modeSelect = document.getElementById('modeSelect');
        const trimSelect = document.getElementById('trimSelect');
        const spacingSelect = document.getElementById('spacingSelect');
        const trimSetting = document.getElementById('trimSetting');
        const spacingSetting = document.getElementById('spacingSetting');

        let convertedImages = [];
        let mergedImage = null;

        // 模式切换事件
        modeSelect.addEventListener('change', handleModeChange);

        function handleModeChange() {
            const isLongMode = modeSelect.value === 'merge';
            trimSetting.style.display = isLongMode ? 'flex' : 'none';
            spacingSetting.style.display = isLongMode ? 'flex' : 'none';
        }

        // 初始化显示状态
        handleModeChange();

        // 上传区域事件
        uploadBox.addEventListener('click', () => fileInput.click());
        uploadBox.addEventListener('dragover', handleDragOver);
        uploadBox.addEventListener('dragleave', handleDragLeave);
        uploadBox.addEventListener('drop', handleDrop);
        fileInput.addEventListener('change', handleFileSelect);
        downloadAllBtn.addEventListener('click', downloadAllImages);
        resetBtn.addEventListener('click', resetApp);

        // 拖拽事件处理
        function handleDragOver(e) {
            e.preventDefault();
            uploadBox.classList.add('dragover');
        }

        function handleDragLeave(e) {
            e.preventDefault();
            uploadBox.classList.remove('dragover');
        }

        function handleDrop(e) {
            e.preventDefault();
            uploadBox.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        }

        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (file) {
                handleFile(file);
            }
        }

        // 文件处理
        function handleFile(file) {
            // 验证文件类型
            if (file.type !== 'application/pdf') {
                showError('请选择PDF文件！');
                return;
            }

            // 验证文件大小 (50MB)
            if (file.size > 50 * 1024 * 1024) {
                showError('文件大小不能超过50MB！');
                return;
            }

            // 显示文件信息
            showFileInfo(file);

            // 开始转换
            convertPDFToImages(file);
        }

        // 显示文件信息
        function showFileInfo(file) {
            const sizeInMB = (file.size / (1024 * 1024)).toFixed(2);
            fileDetails.textContent = `文件名: ${file.name} | 大小: ${sizeInMB}MB`;
            fileInfo.style.display = 'block';
        }

        // PDF转图片核心功能
        async function convertPDFToImages(file) {
            try {
                hideError();
                showProgress(0, '正在读取PDF文件...');

                const arrayBuffer = await file.arrayBuffer();
                const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
                
                showProgress(10, `发现 ${pdf.numPages} 页，开始转换...`);

                const mode = modeSelect.value;
                const format = formatSelect.value;
                const scale = parseFloat(qualitySelect.value);

                if (mode === 'separate') {
                    // 分页模式
                    await convertToSeparateImages(pdf, format, scale);
                } else {
                    // 长条模式
                    await convertToLongImage(pdf, format, scale);
                }

                showProgress(100, '转换完成！');
                setTimeout(() => {
                    hideProgress();
                    showResults();
                }, 500);

            } catch (error) {
                console.error('转换失败:', error);
                showError('PDF转换失败: ' + error.message);
                hideProgress();
            }
        }

        // 分页模式转换
        async function convertToSeparateImages(pdf, format, scale) {
            convertedImages = [];
            imageGrid.innerHTML = '';

            for (let pageNum = 1; pageNum <= pdf.numPages; pageNum++) {
                const progress = 10 + (pageNum / pdf.numPages) * 80;
                showProgress(progress, `正在转换第 ${pageNum}/${pdf.numPages} 页...`);

                const page = await pdf.getPage(pageNum);
                const viewport = page.getViewport({ scale });

                const canvas = document.createElement('canvas');
                const context = canvas.getContext('2d');
                canvas.height = viewport.height;
                canvas.width = viewport.width;

                await page.render({
                    canvasContext: context,
                    viewport: viewport
                }).promise;

                const mimeType = format === 'png' ? 'image/png' : 'image/jpeg';
                const quality = format === 'jpeg' ? 0.9 : undefined;
                const dataUrl = canvas.toDataURL(mimeType, quality);

                convertedImages.push({
                    dataUrl,
                    pageNumber: pageNum,
                    filename: `page_${pageNum.toString().padStart(3, '0')}.${format}`
                });

                addImageToGrid(dataUrl, pageNum, format, false);
            }
        }

        // 长条模式转换
        async function convertToLongImage(pdf, format, scale) {
            const trimMode = trimSelect.value;
            const spacing = parseInt(spacingSelect.value);
            const pageCanvases = [];

            // 第一步：渲染所有页面
            for (let pageNum = 1; pageNum <= pdf.numPages; pageNum++) {
                const progress = 10 + (pageNum / pdf.numPages) * 40;
                showProgress(progress, `正在渲染第 ${pageNum}/${pdf.numPages} 页...`);

                const page = await pdf.getPage(pageNum);
                const viewport = page.getViewport({ scale });

                const canvas = document.createElement('canvas');
                const context = canvas.getContext('2d');
                canvas.height = viewport.height;
                canvas.width = viewport.width;

                await page.render({
                    canvasContext: context,
                    viewport: viewport
                }).promise;

                pageCanvases.push(canvas);
            }

            // 第二步：处理空白和合并
            showProgress(60, '正在处理空白区域...');
            
            const trimmedCanvases = pageCanvases.map((canvas, index) => {
                showProgress(60 + (index / pageCanvases.length) * 20, `正在处理第 ${index + 1} 页空白...`);
                return trimWhitespace(canvas, trimMode);
            });

            // 第三步：合并为长图
            showProgress(80, '正在合并为长图...');
            const mergedCanvas = await mergeCanvases(trimmedCanvases, spacing);

            const mimeType = format === 'png' ? 'image/png' : 'image/jpeg';
            const quality = format === 'jpeg' ? 0.9 : undefined;
            const dataUrl = mergedCanvas.toDataURL(mimeType, quality);

            mergedImage = {
                dataUrl,
                filename: `merged_long_image.${format}`,
                width: mergedCanvas.width,
                height: mergedCanvas.height
            };

            // 清空网格并添加长图预览
            imageGrid.innerHTML = '';
            addLongImageToGrid(dataUrl, pdf.numPages, format);
        }

        // 去除空白的函数
        function trimWhitespace(canvas, trimMode) {
            const ctx = canvas.getContext('2d');
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;

            let top = 0, bottom = canvas.height, left = 0, right = canvas.width;

            // 检测空白区域 (白色或接近白色的像素)
            function isWhitePixel(r, g, b, a) {
                if (a < 10) return true; // 透明像素
                return r > 250 && g > 250 && b > 250; // 接近白色
            }

            if (trimMode === 'auto' || trimMode === 'top') {
                // 检测顶部空白
                topLoop: for (let y = 0; y < canvas.height; y++) {
                    for (let x = 0; x < canvas.width; x++) {
                        const idx = (y * canvas.width + x) * 4;
                        const r = data[idx];
                        const g = data[idx + 1];
                        const b = data[idx + 2];
                        const a = data[idx + 3];
                        if (!isWhitePixel(r, g, b, a)) {
                            top = Math.max(0, y - 10); // 保留10px边距
                            break topLoop;
                        }
                    }
                }
            }

            if (trimMode === 'auto' || trimMode === 'bottom') {
                // 检测底部空白
                bottomLoop: for (let y = canvas.height - 1; y >= 0; y--) {
                    for (let x = 0; x < canvas.width; x++) {
                        const idx = (y * canvas.width + x) * 4;
                        const r = data[idx];
                        const g = data[idx + 1];
                        const b = data[idx + 2];
                        const a = data[idx + 3];
                        if (!isWhitePixel(r, g, b, a)) {
                            bottom = Math.min(canvas.height, y + 10); // 保留10px边距
                            break bottomLoop;
                        }
                    }
                }
            }

            if (trimMode === 'auto') {
                // 检测左侧空白
                leftLoop: for (let x = 0; x < canvas.width; x++) {
                    for (let y = top; y < bottom; y++) {
                        const idx = (y * canvas.width + x) * 4;
                        const r = data[idx];
                        const g = data[idx + 1];
                        const b = data[idx + 2];
                        const a = data[idx + 3];
                        if (!isWhitePixel(r, g, b, a)) {
                            left = Math.max(0, x - 5); // 保留5px边距
                            break leftLoop;
                        }
                    }
                }

                // 检测右侧空白
                rightLoop: for (let x = canvas.width - 1; x >= 0; x--) {
                    for (let y = top; y < bottom; y++) {
                        const idx = (y * canvas.width + x) * 4;
                        const r = data[idx];
                        const g = data[idx + 1];
                        const b = data[idx + 2];
                        const a = data[idx + 3];
                        if (!isWhitePixel(r, g, b, a)) {
                            right = Math.min(canvas.width, x + 5); // 保留5px边距
                            break rightLoop;
                        }
                    }
                }
            }

            // 创建裁剪后的canvas
            const trimmedCanvas = document.createElement('canvas');
            const trimmedCtx = trimmedCanvas.getContext('2d');
            
            const newWidth = right - left;
            const newHeight = bottom - top;
            
            trimmedCanvas.width = newWidth;
            trimmedCanvas.height = newHeight;

            trimmedCtx.drawImage(
                canvas,
                left, top, newWidth, newHeight,
                0, 0, newWidth, newHeight
            );

            return trimmedCanvas;
        }

        // 合并多个canvas为长图
        async function mergeCanvases(canvases, spacing) {
            if (canvases.length === 0) return null;

            // 计算总尺寸
            const maxWidth = Math.max(...canvases.map(c => c.width));
            const totalHeight = canvases.reduce((sum, c) => sum + c.height, 0) + spacing * (canvases.length - 1);

            // 创建合并canvas
            const mergedCanvas = document.createElement('canvas');
            const ctx = mergedCanvas.getContext('2d');
            
            mergedCanvas.width = maxWidth;
            mergedCanvas.height = totalHeight;

            // 填充白色背景
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, maxWidth, totalHeight);

            // 逐个绘制页面
            let currentY = 0;
            for (let i = 0; i < canvases.length; i++) {
                const canvas = canvases[i];
                const x = Math.floor((maxWidth - canvas.width) / 2); // 居中对齐
                
                ctx.drawImage(canvas, x, currentY);
                currentY += canvas.height + spacing;
            }

            return mergedCanvas;
        }

        // 添加长图到网格
        function addLongImageToGrid(dataUrl, totalPages, format) {
            const imageItem = document.createElement('div');
            imageItem.className = 'image-item long-image';
            imageItem.style.gridColumn = '1 / -1'; // 占满整行
            
            const sizeInfo = mergedImage ? `${mergedImage.width} × ${mergedImage.height}px` : '';
            
            imageItem.innerHTML = `
                <img src="${dataUrl}" alt="Merged Long Image" class="image-preview" style="height: auto; max-height: 400px;">
                <div class="image-info">
                    <div class="page-number">📜 长图模式 (${totalPages} 页合并)</div>
                    <div style="font-size: 0.8em; color: #666; margin: 5px 0;">${sizeInfo}</div>
                    <button class="download-btn" onclick="downloadLongImage()">
                        💾 下载长图
                    </button>
                </div>
            `;
            
            imageGrid.appendChild(imageItem);
        }

        // 添加图片到网格
        function addImageToGrid(dataUrl, pageNumber, format, showDownload = true) {
            const imageItem = document.createElement('div');
            imageItem.className = 'image-item';
            
            const downloadBtn = showDownload ? 
                `<button class="download-btn" onclick="downloadImage(${pageNumber - 1})">💾 下载</button>` : '';
            
            imageItem.innerHTML = `
                <img src="${dataUrl}" alt="Page ${pageNumber}" class="image-preview">
                <div class="image-info">
                    <div class="page-number">第 ${pageNumber} 页</div>
                    ${downloadBtn}
                </div>
            `;
            
            imageGrid.appendChild(imageItem);
        }

        // 下载单个图片
        function downloadImage(index) {
            if (convertedImages[index]) {
                const image = convertedImages[index];
                const link = document.createElement('a');
                link.download = image.filename;
                link.href = image.dataUrl;
                link.click();
            }
        }

        // 下载长图
        function downloadLongImage() {
            if (mergedImage) {
                const link = document.createElement('a');
                link.download = mergedImage.filename;
                link.href = mergedImage.dataUrl;
                link.click();
            }
        }

        // 下载所有图片 (ZIP)
        async function downloadAllImages() {
            const mode = modeSelect.value;
            
            if (mode === 'merge') {
                // 长条模式直接下载长图
                downloadLongImage();
                return;
            }

            if (convertedImages.length === 0) return;

            try {
                downloadAllBtn.textContent = '📦 正在打包...';
                downloadAllBtn.disabled = true;

                const zip = new JSZip();
                
                for (const image of convertedImages) {
                    // 将 dataURL 转换为 blob
                    const response = await fetch(image.dataUrl);
                    const blob = await response.blob();
                    zip.file(image.filename, blob);
                }

                const zipBlob = await zip.generateAsync({ type: 'blob' });
                const link = document.createElement('a');
                link.download = 'pdf_images.zip';
                link.href = URL.createObjectURL(zipBlob);
                link.click();

                downloadAllBtn.textContent = '📦 下载所有图片 (ZIP)';
                downloadAllBtn.disabled = false;

            } catch (error) {
                showError('打包下载失败: ' + error.message);
                downloadAllBtn.textContent = '📦 下载所有图片 (ZIP)';
                downloadAllBtn.disabled = false;
            }
        }

        // 显示/隐藏进度
        function showProgress(percent, text) {
            progressContainer.style.display = 'block';
            progressFill.style.width = percent + '%';
            progressText.textContent = text;
        }

        function hideProgress() {
            progressContainer.style.display = 'none';
        }

        // 显示/隐藏错误
        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
        }

        function hideError() {
            errorMessage.style.display = 'none';
        }

        // 显示结果
        function showResults() {
            results.style.display = 'block';
        }

        // 重置应用
        function resetApp() {
            fileInput.value = '';
            fileInfo.style.display = 'none';
            results.style.display = 'none';
            imageGrid.innerHTML = '';
            convertedImages = [];
            mergedImage = null;
            hideError();
            hideProgress();
            
            // 重置下载按钮文本
            const mode = modeSelect.value;
            downloadAllBtn.textContent = mode === 'merge' ? '📜 下载长图' : '📦 下载所有图片 (ZIP)';
        }

        // 更新下载按钮文本
        function updateDownloadButtonText() {
            const mode = modeSelect.value;
            downloadAllBtn.textContent = mode === 'merge' ? '📜 下载长图' : '📦 下载所有图片 (ZIP)';
        }

        // 更新提示信息
        function updateModeHint() {
            const modeHint = document.getElementById('modeHint');
            const mode = modeSelect.value;
            
            if (mode === 'merge') {
                modeHint.textContent = '📜 长条模式：将所有页面合并为一张长图，智能去除空白区域';
                modeHint.style.background = '#e8f5e8';
                modeHint.style.color = '#2e7d32';
            } else {
                modeHint.textContent = '📄 分页模式：每个PDF页面转换为单独的图片文件';
                modeHint.style.background = '#f3e5f5';
                modeHint.style.color = '#7b1fa2';
            }
        }

        // 监听模式变化
        modeSelect.addEventListener('change', () => {
            handleModeChange();
            updateDownloadButtonText();
            updateModeHint();
        });
        
        // 初始化
        updateModeHint();

        // 防止页面拖拽打开文件
        document.addEventListener('dragover', e => e.preventDefault());
        document.addEventListener('drop', e => e.preventDefault());
    </script>
</body>
</html>